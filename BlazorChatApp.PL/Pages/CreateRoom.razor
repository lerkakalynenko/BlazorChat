@page "/createRoom"
@using BlazorChatApp.BLL.Infrastructure.Interfaces
@using BlazorChatApp.BLL.Responses
@using Blazored.LocalStorage
@using System.Net
@inject IRequestService RequestService
@inject NavigationManager NavManager
@inject ILocalStorageService StorageService

<h1>Creating new chat</h1>

<div class="container">
    <p>@notification</p>
    <input @bind:event="oninput" @bind="chatName"/>
    <br />
    <button class="btn btn-primary" type="submit" @onclick="CreateChat" >
        Create new room
    </button>
    </div>
@code
{
    private string chatName;
    private string notification = "";

   
    private async void CreateChat()
    {

        try
        {
            CreateChatResponse roomIsCreated = await RequestService.CreateRoomAsync(chatName);

            if (roomIsCreated.StatusCode == HttpStatusCode.Unauthorized || 
                roomIsCreated.StatusCode == HttpStatusCode.Forbidden)
            {   
                
               NavManager.NavigateTo("/login");

            }
            else
            {
                NavManager.NavigateTo("/chats");
            }
        }
        catch
        {
            notification = $"Failed to create room {chatName}!";

        }
    }

}
